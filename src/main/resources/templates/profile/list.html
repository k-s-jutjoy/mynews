<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">

<head>
	<meta charset="UTF-8">
	<link th:href="@{/css/profile/list.css}" rel="stylesheet">
	<title>プロフィール一覧</title>
	<script>
		function showFullText(element) {
			const parent = element.parentElement;
			parent.querySelector('.abbreviated').style.display = 'none';
			parent.querySelector('.full-text').style.display = 'inline';
			element.style.display = 'none';
		}
	</script>
</head>

<body>
	<main layout:fragment="contents">
		<h1>プロフィール一覧</h1>
		<a th:href="@{/profile/create}">新規プロフィール作成</a>

		<table border="1">
			<tr>
				<th>ID</th>
				<th>名前</th>
				<th>性別</th>
				<th>趣味</th>
				<th>自己紹介</th>
				<th>操作</th>
			</tr>

			<tr th:each="profile : ${profileList}">
				<td th:text="${profile.id}"></td>
				<td th:text="${profile.name}"></td>
				<td th:text="${profile.gender}"></td>
				<td th:text="${profile.hobby}"></td>
				<td class="introduction-cell">
					<!-- 省略表示部分 -->
					<span class="abbreviated"
						th:text="${profile.introduction.length() > 50 ? profile.introduction.substring(0,50) : profile.introduction}"></span>

					<!-- クリックで全文表示（末尾に続ける） -->
					<a href="#" class="show-more" onclick="showFullText(this); return false;"
						th:if="${profile.introduction.length() > 50}" style="display:inline;">...</a>

					<!-- 全文（初期非表示） -->
					<span class="full-text" th:text="${profile.introduction}" style="display:none;"></span>
				</td>

				<td class="action-cell">
					<a class="operation" th:href="@{/profile/edit(id=${profile.id})}">編集</a>
					<span>|</span>
					<form th:action="@{/profile/delete}" method="post" style="display:inline">
						<input type="hidden" th:name="id" th:value="${profile.id}" />
						<button class="btn" type="submit">削除</button>
					</form>
				</td>
			</tr>
		</table>

	</main>
</body>

</html>